function triggerOverload() {
    if (overloading) return;
    overloading = true;

    // 1. 全螢幕抖動
    document.body.classList.add("shake");
    setTimeout(() => {
        document.body.classList.remove("shake");
        showFullScreenDialogue();
    }, 800);
}

function showFullScreenDialogue() {
    const screen = document.createElement("div");
    screen.id = "dialogueScreen";
    Object.assign(screen.style, {
        position: "fixed",
        top: "0",
        left: "0",
        width: "100vw",
        height: "100vh",
        background: "black",
        color: "white",
        fontSize: "2.8rem",
        display: "flex",
        justifyContent: "center",
        alignItems: "center",
        textAlign: "center",
        zIndex: "9999",
        opacity: "0",
        transition: "opacity 0.5s"
    });
    document.body.appendChild(screen);

    // 讓畫面淡入
    setTimeout(() => {
        screen.style.opacity = "1";
    }, 50);

    // 角色台詞
    const lines = [
        "哈哈！我終於成功了…",
        "但是魔力失控後，一切都會…… 都會……"
    ];

    let index = 0;

    function nextLine() {
        if (index < lines.length) {
            screen.innerHTML = lines[index];
            index++;
            setTimeout(nextLine, 1500); // ⬅ 延遲變長
        } else {
            showZeroEffect(screen);
        }
    }

    nextLine();
}

function showZeroEffect(screen) {
    screen.innerHTML = "";

    const zero1 = document.createElement("div");
    const zero2 = document.createElement("div");

    Object.assign(zero1.style, effectStyle("歸", "-20px"));
    Object.assign(zero2.style, effectStyle("零", "20px"));

    screen.appendChild(zero1);
    screen.appendChild(zero2);

    setTimeout(() => {
        darkenAndReload();
    }, 1600);
}

function effectStyle(text, offset) {
    return {
        position: "absolute",
        top: "50%",
        left: `calc(50% + ${offset})`,
        transform: "translate(-50%, -50%) scale(1)",
        padding: "25px 50px",
        background: "red",
        color: "white",
        fontSize: "4rem",
        fontWeight: "900",
        borderRadius: "10px",
        animation: "pulse 0.5s infinite alternate",
        content: `"${text}"`,
    };
}

function darkenAndReload() {
    // 全黑遮罩
    const dark = document.createElement("div");
    Object.assign(dark.style, {
        position: "fixed",
        top: "0",
        left: "0",
        width: "100vw",
        height: "100vh",
        background: "black",
        opacity: "0",
        transition: "opacity 1s",
        zIndex: "10000"
    });
    document.body.appendChild(dark);

    setTimeout(() => {
        dark.style.opacity = "1";
        document.title = "（無回應）";
    }, 50);

    setTimeout(() => {
        location.reload();   // ⬅ 正常重跑
    }, 1800);
}

